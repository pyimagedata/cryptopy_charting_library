/**
 * Left Drawing Toolbar Widget - TradingView-style with grouped flyout menus
 */

import { Delegate } from '../../helpers/delegate';

// SVG Icons for drawing tools
const DRAWING_ICONS = {
    // Pointer tools
    cursor: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/>
    </svg>`,
    crosshair: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><g fill="currentColor"><path d="M18 15h8v-1h-8z"></path><path d="M14 18v8h1v-8zM14 3v8h1v-8zM3 15h8v-1h-8z"></path></g></svg>`,
    arrowCursor: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M11.682 16.09l3.504 6.068 1.732-1-3.497-6.057 3.595-2.1L8 7.74v10.512l3.682-2.163zm-.362 1.372L7 20V6l12 7-4.216 2.462 3.5 6.062-3.464 2-3.5-6.062z"></path></svg>`,

    // Lines
    trendLine: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M7.354 21.354l14-14-.707-.707-14 14z"></path><path d="M22.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    ray: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M8.354 20.354l5-5-.707-.707-5 5z"></path><path d="M16.354 12.354l8-8-.707-.707-8 8z"></path><path d="M14.5 15c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM6.5 23c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    infoLine: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero" clip-rule="evenodd"><path d="M22.4989 4C21.6705 4 20.9989 4.67157 20.9989 5.5C20.9989 5.91456 21.1664 6.28904 21.4387 6.56106C21.7106 6.83282 22.0848 7 22.4989 7C23.3274 7 23.9989 6.32843 23.9989 5.5C23.9989 4.67157 23.3274 4 22.4989 4ZM19.9989 5.5C19.9989 4.11929 21.1182 3 22.4989 3C23.8796 3 24.9989 4.11929 24.9989 5.5C24.9989 6.88071 23.8796 8 22.4989 8C21.9899 8 21.5159 7.8475 21.1209 7.58617L7.58575 21.1214C7.84733 21.5165 8 21.9907 8 22.5C8 23.8807 6.88071 25 5.5 25C4.11929 25 3 23.8807 3 22.5C3 21.1193 4.11929 20 5.5 20C6.00932 20 6.48351 20.1527 6.87864 20.4143L20.4136 6.87929C20.1518 6.48403 19.9989 6.0096 19.9989 5.5ZM5.5 21C4.67157 21 4 21.6716 4 22.5C4 23.3284 4.67157 24 5.5 24C6.32843 24 7 23.3284 7 22.5C7 22.0856 6.83265 21.7113 6.56066 21.4393C6.28867 21.1673 5.91435 21 5.5 21Z"></path><path d="M16 19.5C16 18.1193 17.1193 17 18.5 17H23.5C24.8807 17 26 18.1193 26 19.5V22.5C26 23.8807 24.8807 25 23.5 25H18.5C17.1193 25 16 23.8807 16 22.5V19.5ZM18.5 18C17.6716 18 17 18.6716 17 19.5V22.5C17 23.3284 17.6716 24 18.5 24H23.5C24.3284 24 25 23.3284 25 22.5V19.5C25 18.6716 24.3284 18 23.5 18H18.5Z"></path></g></svg>`,
    extendedLine: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M4.354 25.354l5-5-.707-.707-5 5z"></path><path d="M12.354 17.354l5-5-.707-.707-5 5z"></path><path d="M20.354 9.354l5-5-.707-.707-5 5z"></path><path d="M18.5 12c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM10.5 20c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    trendAngle: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M15.5 22.5c0-2.697-1.073-5.225-2.947-7.089l-.705.709c1.687 1.679 2.652 3.952 2.652 6.38h1z"></path><path d="M7.354 21.354l14-14-.707-.707-14 14z"></path><path d="M7.5 23h16.5v-1h-16.5z"></path><path d="M22.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    horizontalLine: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M4 15h8.5v-1h-8.5zM16.5 15h8.5v-1h-8.5z"></path><path d="M14.5 16c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    horizontalRay: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M8.5 15h16.5v-1h-16.5z"></path><path d="M6.5 16c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    verticalLine: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M15 12.5v-8.5h-1v8.5zM14 16.5v8.5h1v-8.5z"></path><path d="M14.5 16c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    crossLine: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M4 15h8.5v-1h-8.5zM16.5 15h8.5v-1h-8.5z"></path><path d="M15 12v-8.5h-1v8.5zM14 16.5v8.5h1v-8.5z"></path><path d="M14.5 16c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,

    // Channels
    parallelChannel: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M8.354 18.354l10-10-.707-.707-10 10zM12.354 25.354l5-5-.707-.707-5 5z"></path><path d="M20.354 17.354l5-5-.707-.707-5 5z"></path><path d="M19.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM6.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM18.5 20c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    regressionTrend: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M7.551 17.98l13.284-7.033-.468-.884-13.284 7.033z"></path><path d="M6 11.801l16-8.471v4.17h1v-5.83l-18 9.529v5.301h1z"></path><path d="M6 24.67v-4.17h-1v5.83l18-9.529v-5.301h-1v4.699z"></path><path d="M5.5 20c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 11c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,


    // Fibonacci
    fibRetracement: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M3 5h22v-1h-22z"></path><path d="M3 17h22v-1h-22z"></path><path d="M3 11h19.5v-1h-19.5z"></path><path d="M5.5 23h19.5v-1h-19.5z"></path><path d="M3.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM24.5 12c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    fibExtension: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M4 25h22v-1h-22z"></path><path d="M4 21h22v-1h-22z"></path><path d="M6.5 17h19.5v-1h-19.5z"></path><path d="M5 14.5v-3h-1v3zM6.617 9.275l10.158-3.628-.336-.942-10.158 3.628z"></path><path d="M18.5 6c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM4.5 11c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM4.5 18c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    fibChannel: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M7.463 12.026l13.537-7.167-.468-.884-13.537 7.167z"></path><path d="M22.708 16.824l-17.884 9.468.468.884 17.884-9.468z"></path><path d="M22.708 9.824l-15.839 8.386.468.884 15.839-8.386z"></path><path d="M5.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 5c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,



    // Shapes
    rectangle: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M7.5 6h13v-1h-13z" id="Line"></path><path d="M7.5 23h13v-1h-13z"></path><path d="M5 7.5v13h1v-13z"></path><path d="M22 7.5v13h1v-13z"></path><path d="M5.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    rotatedRectangle: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M14.743 3.55l-4.208 4.208.707.707 4.208-4.208zM7.71 10.583l-4.187 4.187.707.707 4.187-4.187zM3.536 18.244l6.171 6.171.707-.707-6.171-6.171zM13.232 24.475l4.22-4.22-.707-.707-4.22 4.22zM20.214 17.494l4.217-4.217-.707-.707-4.217 4.217zM24.423 9.716l-6.218-6.218-.707.707 6.218 6.218z"></path><path d="M2.5 18c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM9.5 11c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM16.5 4c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM11.5 27c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM18.5 20c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM25.5 13c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    ellipse: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M12.435 6.136c-4.411.589-7.983 3.039-9.085 6.27l.946.323c.967-2.836 4.209-5.059 8.271-5.602l-.132-.991zM3.347 16.584c1.101 3.243 4.689 5.701 9.117 6.283l.13-.991c-4.079-.537-7.335-2.767-8.301-5.613l-.947.321zM16.554 22.865c4.381-.582 7.94-3 9.071-6.2l-.943-.333c-.994 2.811-4.224 5.006-8.26 5.542l.132.991zM25.646 12.394c-1.107-3.225-4.675-5.668-9.078-6.257l-.133.991c4.056.542 7.293 2.76 8.265 5.591l.946-.325z"></path><path d="M14.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM14.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM3.5 16c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM25.5 16c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    triangle: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M8.5 23h11v-1h-11zM6 8.5v12h1v-12zM7.483 8.28l12.293 13.112.73-.684-12.293-13.112z"></path><path d="M6.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM6.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM21.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    arc: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M8.013 23.846c4.923 2.247 9.792 2.626 13.448-.517l-.652-.758c-3.277 2.817-7.775 2.467-12.381.365l-.415.91z"></path><path d="M24.035 20.056c2.262-4.176 1.814-8.73-.13-12.98l-.909.416c1.826 3.993 2.244 8.24.16 12.088l.879.476z"></path><path d="M8.221 21.401l13.249-14.077-.728-.685-13.249 14.077z"></path><path d="M6.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 23c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    path: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><path fill="currentColor" d="M11 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm4 7a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0zm11-8.8V13h1V7h-6v1h4.3l-7.42 7.41a2.49 2.49 0 0 0-2.76 0l-3.53-3.53a2.5 2.5 0 1 0-4.17 0L1 18.29l.7.71 6.42-6.41a2.49 2.49 0 0 0 2.76 0l3.53 3.53a2.5 2.5 0 1 0 4.17 0z"></path></svg>`,
    circle: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20" fill="none"><path stroke="currentColor" d="M16 14a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z"></path><path fill="currentColor" fill-rule="evenodd" d="M4.5 14a9.5 9.5 0 0 1 18.7-2.37 2.5 2.5 0 0 0 0 4.74A9.5 9.5 0 0 1 4.5 14Zm19.7 2.5a10.5 10.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5ZM22.5 14a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"></path></svg>`,
    polyline: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M16.5 6h4v-1h-4z" id="Line"></path><path d="M16.5 15h4v-1h-4z"></path><path d="M8.5 23h4v-1h-4z"></path><path d="M8.298 11.591l5.097-4.46-.659-.753-5.097 4.46zM22 7.5v5h1v-5z"></path><path d="M14 16.5v4h1v-4z"></path><path d="M6 14.5v6h1v-6z"></path><path d="M6.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM14.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM14.5 16c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 16c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM6.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM14.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    highlighter: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 23" width="20" height="20"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M13.402 0L6.78144 6.71532C6.67313 6.82518 6.5917 6.95862 6.54354 7.10518L5.13578 11.3889C4.89843 12.1111 5.08375 12.9074 5.61449 13.4458L5.68264 13.5149L0 19.2789L8.12695 22.4056L11.2874 19.1999L11.3556 19.269C11.8863 19.8073 12.6713 19.9953 13.3834 19.7546L17.6013 18.3285C17.7493 18.2784 17.8835 18.1945 17.9931 18.0832L24.6912 11.2892L23.9857 10.5837L17.515 17.147L7.70658 7.19818L14.1076 0.705575L13.402 0ZM6.07573 11.7067L7.24437 8.15061L16.576 17.6158L13.0701 18.8012C12.7141 18.9215 12.3215 18.8275 12.0562 18.5584L6.31509 12.7351C6.04972 12.466 5.95706 12.0678 6.07573 11.7067ZM6.30539 14.3045L10.509 18.5682L7.87935 21.2355L1.78414 18.8904L6.30539 14.3045Z"></path></svg>`,
    arrowMarker: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M22.38 4.04h.04a1.3 1.3 0 0 1 1.21.33c.37.36.42.84.33 1.2v.04l-2.45 8.32c-.14.55-.57.91-1 1.04-.45.14-1.2.07-1.55-.63l-.34-.64-12.6 10.03c-.3.25-.67.31-1 .25a1.3 1.3 0 0 1-1.01-1.06c-.05-.31.02-.69.29-.99l.02-.02a35.13 35.13 0 0 0 .47-.57 1749.6 1749.6 0 0 0 5-6.15l3.7-4.57.91-1.13-.63-.33c-.7-.36-.77-1.1-.64-1.55.13-.44.5-.86 1.03-1l8.22-2.57zm-7.95 3.53c-.35.08-.5.56-.2.7l1.71.91-.64.8a17294.8 17294.8 0 0 1-10.24 12.6l-.01.02c-.17.19.15.52.33.35l13.55-10.78.92 1.7c.14.3.62.16.7-.2l2.44-8.31c.05-.24-.1-.4-.35-.35l-8.2 2.56zM5.8 23.27z"></path></svg>`,
    curve: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M6.256 20.652c.548-3.024 1.607-5.962 3.329-8.312l-.807-.591c-1.825 2.493-2.933 5.565-3.506 8.725l.984.178z"></path><path d="M12.243 9.657c2.365-1.764 5.345-2.846 8.416-3.402l-.178-.984c-3.21.581-6.326 1.712-8.836 3.584l.598.802z"></path><path d="M10.5 12c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,



    // Patterns
    headShoulders: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M4.436 21.667l2.083-9.027-.974-.225-2.083 9.027zM10.046 16.474l-2.231-4.463-.894.447 2.231 4.463zM13.461 6.318l-2.88 10.079.962.275 2.88-10.079zM18.434 16.451l-2.921-10.224-.962.275 2.921 10.224zM21.147 12.089l-2.203 4.405.894.447 2.203-4.405zM25.524 21.383l-2.09-9.055-.974.225 2.09 9.055z"></path><path d="M1 19h7.5v-1h-7.5z"></path><path d="M12.5 19h4v-1h-4z"></path><path d="M20.5 19h6.5v-1h-6.5z"></path><path d="M6.5 12c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM3.5 25c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM10.5 20c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM18.5 20c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 12c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM25.5 25c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM14.5 6c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    abcd: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M21.487 5.248l-12.019 1.502.124.992 12.019-1.502zM6.619 9.355l-2.217 11.083.981.196 2.217-11.083zM6.534 22.75l12.071-1.509-.124-.992-12.071 1.509zM21.387 18.612l2.21-11.048-.981-.196-2.21 11.048zM8.507 9.214l10.255 10.255.707-.707-10.255-10.255z"></path><path d="M7.5 9c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM4.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM23.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM20.5 22c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    xabcd: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M20.449 8.505l2.103 9.112.974-.225-2.103-9.112zM13.943 14.011l7.631 4.856.537-.844-7.631-4.856zM14.379 11.716l4.812-3.609-.6-.8-4.812 3.609zM10.96 13.828l-4.721 6.744.819.573 4.721-6.744zM6.331 20.67l2.31-13.088-.985-.174-2.31 13.088zM9.041 7.454l1.995 3.492.868-.496-1.995-3.492z"></path><path d="M8.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM12.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM20.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM23.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    cypher: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor"><path d="M15.246 21.895l1.121.355c-.172.625-.458 1.089-.857 1.393-.4.303-.907.455-1.521.455-.76 0-1.385-.26-1.875-.779-.49-.52-.734-1.23-.734-2.131 0-.953.246-1.693.738-2.221.492-.527 1.139-.791 1.941-.791.701 0 1.27.207 1.707.621.26.245.456.596.586 1.055l-1.145.273c-.068-.297-.209-.531-.424-.703-.215-.172-.476-.258-.783-.258-.424 0-.769.152-1.033.457-.264.305-.396.798-.396 1.48 0 .724.13 1.24.391 1.547.26.307.599.461 1.016.461.307 0 .572-.098.793-.293.221-.195.38-.503.477-.922z"></path><path fill-rule="nonzero" d="M20.449 8.505l2.103 9.112.974-.225-2.103-9.112zM13.943 14.011l7.631 4.856.537-.844-7.631-4.856zM14.379 11.716l4.812-3.609-.6-.8-4.812 3.609zM10.96 13.828l-4.721 6.744.819.573 4.721-6.744zM6.331 20.67l2.31-13.088-.985-.174-2.31 13.088zM9.041 7.454l1.995 3.492.868-.496-1.995-3.492z"></path><path fill-rule="nonzero" d="M8.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM12.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM20.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM23.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    trianglePattern: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M9.457 18.844l-5.371 2.4.408.913 5.371-2.4z"></path><path d="M13.13 17.203l.408.913 13.688-6.116-6.736-3.01-.408.913 4.692 2.097z"></path><path d="M11.077 5.88l5.34 2.386.408-.913-5.34-2.386z"></path><path d="M7.401 4.237l.408-.913-5.809-2.595v19.771h1v-18.229z"></path><path d="M3.708 20.772l5.51-14.169-.932-.362-5.51 14.169zM9.265 6.39l1.46 10.218.99-.141-1.46-10.218zM13.059 17.145l4.743-6.775-.819-.573-4.743 6.775z"></path><path d="M9.5 6c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM11.5 20c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM18.5 10c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM2.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    threeDrives: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M.303 17.674l1.104.473.394-.919-1.104-.473z"></path><path d="M5.133 19.744l3.335 1.429.394-.919-3.335-1.429z"></path><path d="M12.134 22.744l3.352 1.436.394-.919-3.352-1.436z"></path><path d="M19.203 25.774l1.6 .686.394-.919-1.6-.686z"></path><path d="M.3 4.673l1.13.484.394-.919-1.13-.484-.394.919zm.394-.919l1.13.484-.394.919-1.13-.484.394-.919z"></path><path d="M5.141 6.747l3.325 1.425.394-.919-3.325-1.425z"></path><path d="M12.133 9.744l3.353 1.437.394-.919-3.353-1.437z"></path><path d="M19.221 12.782l5.838 2.502.394-.919-5.838-2.502z"></path><path d="M3 7.473v8.969h1v-8.969zM8.93 9.871l-4.616 6.594.819.573 4.616-6.594zM11 19.5v-9h-1v9zM15.898 12.916l-4.616 6.594.819.573 4.616-6.594zM18 22.5v-9h-1v9zM24.313 5.212l-6.57 17.247.934.356 6.57-17.247z"></path><path d="M3.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM3.5 20c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM10.5 23c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM17.5 13c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM25.5 5c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM17.5 26c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM10.5 10c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    elliotImpulse: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor"><path fill-rule="nonzero" d="M5.238 18.469l4.17-4.17-.707-.707-4.17 4.17zM16.47 17.763l-.707.707-4.265-4.265.707-.707zM22.747 13.546l-4.192 4.192.707.707 4.192-4.192z"></path><path fill-rule="nonzero" d="M10.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM17.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM24.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM3.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path><path d="M11.148 7h-1.098v-4.137c-.401.375-.874.652-1.418.832v-.996c.286-.094.598-.271.934-.533.336-.262.566-.567.691-.916h.891v5.75z"></path><path d="M23.355 5.527l1.094-.113c.031.247.124.443.277.588.154.145.331.217.531.217.229 0 .423-.093.582-.279.159-.186.238-.467.238-.842 0-.352-.079-.615-.236-.791-.158-.176-.363-.264-.615-.264-.315 0-.598.139-.848.418l-.891-.129.563-2.98h2.902v1.027h-2.07l-.172.973c.245-.122.495-.184.75-.184.487 0 .9.177 1.238.531.339.354.508.814.508 1.379 0 .471-.137.892-.41 1.262-.372.505-.889.758-1.551.758-.529 0-.96-.142-1.293-.426-.333-.284-.533-.665-.598-1.145z"></path></g></svg>`,
    elliotCorrection: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor"><path fill-rule="nonzero" d="M5.238 18.469l4.17-4.17-.707-.707-4.17 4.17zM16.47 17.763l-.707.707-4.265-4.265.707-.707zM22.747 13.546l-4.192 4.192.707.707 4.192-4.192z"></path><path fill-rule="nonzero" d="M10.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM17.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM24.5 14c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM3.5 21c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path><path d="M13.746 7h-1.258l-.5-1.301h-2.289l-.473 1.301h-1.227l2.23-5.727h1.223l2.293 5.727zm-2.129-2.266l-.789-2.125-.773 2.125h1.563z"></path><path d="M26.246 4.895l1.121.355c-.172.625-.458 1.089-.857 1.393-.4.303-.907.455-1.521.455-.76 0-1.385-.26-1.875-.779-.49-.52-.734-1.23-.734-2.131 0-.953.246-1.693.738-2.221.492-.527 1.139-.791 1.941-.791.701 0 1.27.207 1.707.621.26.245.456.596.586 1.055l-1.145.273c-.068-.297-.209-.531-.424-.703-.215-.172-.476-.258-.783-.258-.424 0-.769.152-1.033.457-.264.305-.396.798-.396 1.48 0 .724.13 1.24.391 1.547.26.307.599.461 1.016.461.307 0 .572-.098.793-.293.221-.195.38-.503.477-.922z"></path></g></svg>`,
    longPosition: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M4.5 5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2 6.5A2.5 2.5 0 0 1 6.95 6H24v1H6.95A2.5 2.5 0 0 1 2 6.5zM4.5 15a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2 16.5a2.5 2.5 0 0 1 4.95-.5h13.1a2.5 2.5 0 1 1 0 1H6.95A2.5 2.5 0 0 1 2 16.5zM22.5 15a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-18 6a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2 22.5a2.5 2.5 0 0 1 4.95-.5H24v1H6.95A2.5 2.5 0 0 1 2 22.5z"></path><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M22.4 8.94l-1.39.63-.41-.91 1.39-.63.41.91zm-4 1.8l-1.39.63-.41-.91 1.39-.63.41.91zm-4 1.8l-1.4.63-.4-.91 1.39-.63.41.91zm-4 1.8l-1.4.63-.4-.91 1.39-.63.41.91z"></path></svg>`,
    shortPosition: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M4.5 24a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM2 22.5a2.5 2.5 0 0 0 4.95.5H24v-1H6.95a2.5 2.5 0 0 0-4.95.5zM4.5 14a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM2 12.5a2.5 2.5 0 0 0 4.95.5h13.1a2.5 2.5 0 1 0 0-1H6.95a2.5 2.5 0 0 0-4.95.5zM22.5 14a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm-18-6a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM2 6.5a2.5 2.5 0 0 0 4.95.5H24V6H6.95A2.5 2.5 0 0 0 2 6.5z"></path><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M22.4 20.06l-1.39-.63-.41.91 1.39.63.41-.91zm-4-1.8l-1.39-.63-.41.91 1.39.63.41-.91zm-4-1.8l-1.4-.63-.4.91 1.39.63.41-.91zm-4-1.8L9 14.03l-.4.91 1.39.63.41-.91z"></path></svg>`,
    priceRange: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor"><path fill-rule="nonzero" d="M4 5h16.5v-1h-16.5zM25 24h-16.5v1h16.5z" id="Line"></path><path fill-rule="nonzero" d="M6.5 26c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM22.5 6c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path><path fill-rule="nonzero" d="M14 9v14h1v-14z"></path><path d="M14.5 6l2.5 3h-5z"></path></g></svg>`,
    dateRange: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor"><path fill-rule="nonzero" d="M20 14h-14v1h14z" id="Line"></path><path d="M20 17v-5l3 2.5z"></path><path fill-rule="nonzero" d="M24 8.5v16.5h1v-16.5zM4 4v16.5h1v-16.5z"></path><path fill-rule="nonzero" d="M4.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM24.5 8c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    datePriceRange: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor"><path fill-rule="nonzero" d="M6.5 23v1h17.5v-17.5h-1v16.5z"></path><path fill-rule="nonzero" d="M21.5 5v-1h-17.5v17.5h1v-16.5z"></path><path fill-rule="nonzero" d="M4.5 25c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM23.5 6c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path><path fill-rule="nonzero" d="M13 9v13h1v-13z" id="Line"></path><path d="M13.5 6l2.5 3h-5z"></path><path fill-rule="nonzero" d="M19 14h-13v1h13z"></path><path d="M19 17v-5l3 2.5z"></path></g></svg>`,
    flagMarked: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><path fill="currentColor" fill-rule="nonzero" d="M7.382 16h14.483l-4.167-5 4.167-5h-15.865v12.764l1.382-2.764zm-2.382 7v-18h19l-5 6 5 6h-16l-3 6z"></path></svg>`,





    // Annotation
    text: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><path fill="currentColor" d="M8 6.5c0-.28.22-.5.5-.5H14v16h-2v1h5v-1h-2V6h5.5c.28 0 .5.22.5.5V9h1V6.5c0-.83-.67-1.5-1.5-1.5h-12C7.67 5 7 5.67 7 6.5V9h1V6.5Z"></path></svg>`,
    callout: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><path fill="currentColor" fill-rule="nonzero" d="M6 21.586l3.586-3.586h13.407c.004 0 .007-11.993.007-11.993 0-.007-17-.007-17-.007v15.586zm-1 2.414v-18.005c0-.549.451-.995.995-.995h17.01c.549 0 .995.45.995 1.007v11.986c0 .556-.45 1.007-1.007 1.007h-12.993l-5 5z"></path></svg>`,
    priceLabel: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M6.995 5c.008 0 .005 15.5.005 15.5h-1v-15.493c0-.556.451-1.007.995-1.007h17.01c.549 0 .995.45.995 1.007v11.986c0 .556-.45 1.007-1.007 1.007h-12.993l-3.104 3.104-.707-.707 3.397-3.397h13.407c.004 0 .007-11.993.007-11.993 0-.007-17.005-.007-17.005-.007z"></path><path d="M6.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    arrow: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor"><path fill-rule="nonzero" d="M7.354 21.354l14-14-.707-.707-14 14z"></path><path d="M21 7l-8 3 5 5z"></path><path fill-rule="nonzero" d="M22.5 7c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5zM5.5 24c.828 0 1.5-.672 1.5-1.5s-.672-1.5-1.5-1.5-1.5.672-1.5 1.5.672 1.5 1.5 1.5zm0 1c-1.381 0-2.5-1.119-2.5-2.5s1.119-2.5 2.5-2.5 2.5 1.119 2.5 2.5-1.119 2.5-2.5 2.5z"></path></g></svg>`,
    arrowMarkedUp: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><path fill="currentColor" fill-rule="nonzero" d="M11 16v6h6v-6h4.865l-7.865-9.438-7.865 9.438h4.865zm7 7h-8v-6h-6l10-12 10 12h-6v6z"></path></svg>`,
    arrowMarkedDown: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><path fill="currentColor" fill-rule="nonzero" d="M17 12v-6h-6v6h-4.865l7.865 9.438 7.865-9.438h-4.865zm-7-7h8v6h6l-10 12-10-12h6v-6z"></path></svg>`,
    sticker: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M6 14.5C6 9.78 9.78 6 14.5 6c4.72 0 8.5 3.78 8.5 8.5 0 4.72-3.78 8.5-8.5 8.5A8.46 8.46 0 0 1 6 14.5zM14.5 5A9.46 9.46 0 0 0 5 14.5c0 5.28 4.22 9.5 9.5 9.5s9.5-4.22 9.5-9.5S19.78 5 14.5 5zM12 12a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm4 1a1 1 0 1 1 2 0 1 1 0 0 1-2 0zm-6 4l-.43.26v.01l.03.03a3.55 3.55 0 0 0 .3.4 5.7 5.7 0 0 0 9.22 0 5.42 5.42 0 0 0 .28-.4l.02-.03v-.01L19 17l-.43-.26v.02a2.45 2.45 0 0 1-.24.32c-.17.21-.43.5-.78.79a4.71 4.71 0 0 1-6.88-.8 4.32 4.32 0 0 1-.23-.31l-.01-.02L10 17z"></path></svg>`,



    // Tools
    measure: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 4l16 16M4 4v6M4 4h6M20 20v-6M20 20h-6"/>
    </svg>`,
    brush: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="20" height="20"><g fill="currentColor" fill-rule="nonzero"><path d="M1.789 23l.859-.854.221-.228c.18-.19.38-.409.597-.655.619-.704 1.238-1.478 1.815-2.298.982-1.396 1.738-2.776 2.177-4.081 1.234-3.667 5.957-4.716 8.923-1.263 3.251 3.785-.037 9.38-5.379 9.38h-9.211zm9.211-1c4.544 0 7.272-4.642 4.621-7.728-2.45-2.853-6.225-2.015-7.216.931-.474 1.408-1.273 2.869-2.307 4.337-.599.852-1.241 1.653-1.882 2.383l-.068.078h6.853z"></path><path d="M18.182 6.002l-1.419 1.286c-1.031.935-1.075 2.501-.096 3.48l1.877 1.877c.976.976 2.553.954 3.513-.045l5.65-5.874-.721-.693-5.65 5.874c-.574.596-1.507.609-2.086.031l-1.877-1.877c-.574-.574-.548-1.48.061-2.032l1.419-1.286-.672-.741z"></path></g></svg>`,
    zoom: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="10" cy="10" r="7"/>
        <line x1="15" y1="15" x2="21" y2="21"/>
        <line x1="7" y1="10" x2="13" y2="10"/>
        <line x1="10" y1="7" x2="10" y2="13"/>
    </svg>`,

    // Utility
    magnet: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M6 4v4a6 6 0 0 0 12 0V4M6 4h4M14 4h4M6 8h4M14 8h4"/>
    </svg>`,
    weakMagnet: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><g fill="currentColor" fill-rule="evenodd"><path fill-rule="nonzero" d="M14 10a2 2 0 0 0-2 2v11H6V12c0-4.416 3.584-8 8-8s8 3.584 8 8v11h-6V12a2 2 0 0 0-2-2zm-3 2a3 3 0 0 1 6 0v10h4V12c0-3.864-3.136-7-7-7s-7 3.136-7 7v10h4V12z"></path><path d="M6.5 18h5v1h-5zm10 0h5v1h-5z"></path></g></svg>`,
    strongMagnet: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" fill-rule="nonzero" d="M14 5a7 7 0 0 0-7 7v3h4v-3a3 3 0 1 1 6 0v3h4v-3a7 7 0 0 0-7-7zm7 11h-4v3h4v-3zm-10 0H7v3h4v-3zm-5-4a8 8 0 1 1 16 0v8h-6v-8a2 2 0 1 0-4 0v8H6v-8zm3.293 11.294l-1.222-2.037.858-.514 1.777 2.963-2 1 1.223 2.037-.858.514-1.778-2.963 2-1zm9.778-2.551l.858.514-1.223 2.037 2 1-1.777 2.963-.858-.514 1.223-2.037-2-1 1.777-2.963z"></path></svg>`,
    lock: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" fill-rule="evenodd" d="M14 6a3 3 0 0 0-3 3v3h8.5a2.5 2.5 0 0 1 2.5 2.5v7a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 6 21.5v-7A2.5 2.5 0 0 1 8.5 12H10V9a4 4 0 0 1 8 0h-1a3 3 0 0 0-3-3zm-1 11a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6-2.5c0-.83.67-1.5 1.5-1.5h11c.83 0 1.5.67 1.5 1.5v7c0 .83-.67 1.5-1.5 1.5h-11A1.5 1.5 0 0 1 7 21.5v-7z"></path></svg>`,
    lockClosed: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" fill-rule="evenodd" d="M14 4a5 5 0 0 0-5 5v3H7a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V14a2 2 0 0 0-2-2h-2V9a5 5 0 0 0-5-5zm-4 5a4 4 0 1 1 8 0v3h-8V9zm4 8a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"></path></svg>`,
    visible: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><path fill="currentColor" fill-rule="evenodd" d="M5 10.76l-.41-.72-.03-.04.03-.04a15 15 0 012.09-2.9c1.47-1.6 3.6-3.12 6.32-3.12 2.73 0 4.85 1.53 6.33 3.12a15.01 15.01 0 012.08 2.9l.03.04-.03.04a15 15 0 01-2.09 2.9c-1.47 1.6-3.6 3.12-6.32 3.12-2.73 0-4.85-1.53-6.33-3.12a15 15 0 01-1.66-2.18zm17.45-.98L22 10l.45.22-.01.02a5.04 5.04 0 01-.15.28 16.01 16.01 0 01-2.23 3.1c-1.56 1.69-3.94 3.44-7.06 3.44-3.12 0-5.5-1.75-7.06-3.44a16 16 0 01-2.38-3.38v-.02h-.01L4 10l-.45-.22.01-.02a5.4 5.4 0 01.15-.28 16 16 0 012.23-3.1C7.5 4.69 9.88 2.94 13 2.94c3.12 0 5.5 1.75 7.06 3.44a16.01 16.01 0 012.38 3.38v.02h.01zM22 10l.45-.22.1.22-.1.22L22 10zM3.55 9.78L4 10l-.45.22-.1-.22.1-.22zm6.8.22A2.6 2.6 0 0113 7.44 2.6 2.6 0 0115.65 10 2.6 2.6 0 0113 12.56 2.6 2.6 0 0110.35 10zM13 6.44A3.6 3.6 0 009.35 10 3.6 3.6 0 0013 13.56c2 0 3.65-1.58 3.65-3.56A3.6 3.6 0 0013 6.44zm7.85 12l.8-.8.7.71-.79.8a.5.5 0 000 .7l.59.59c.2.2.5.2.7 0l1.8-1.8.7.71-1.79 1.8a1.5 1.5 0 01-2.12 0l-.59-.59a1.5 1.5 0 010-2.12zM16.5 21.5l-.35-.35a.5.5 0 00-.07.07l-1 1.5-1 1.5a.5.5 0 00.42.78h4a2.5 2.5 0 001.73-.77A2.5 2.5 0 0021 22.5a2.5 2.5 0 00-.77-1.73A2.5 2.5 0 0018.5 20a3.1 3.1 0 00-1.65.58 5.28 5.28 0 00-.69.55v.01h-.01l.35.36zm.39.32l-.97 1.46-.49.72h3.07c.34 0 .72-.17 1.02-.48.3-.3.48-.68.48-1.02 0-.34-.17-.72-.48-1.02-.3-.3-.68-.48-1.02-.48-.35 0-.75.18-1.1.42a4.27 4.27 0 00-.51.4z"></path></svg>`,
    hidden: `<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><path fill="currentColor" fill-rule="evenodd" d="M19.76 6.07l-.7.7a13.4 13.4 0 011.93 2.47c.19.3.33.55.42.72l.03.04-.03.04a15 15 0 01-2.09 2.9c-1.47 1.6-3.6 3.12-6.32 3.12-.98 0-1.88-.2-2.7-.52l-.77.76c1.03.47 2.18.76 3.47.76 3.12 0 5.5-1.75 7.06-3.44a16 16 0 002.38-3.38v-.02h.01L22 10l.45.22.1-.22-.1-.22L22 10l.45-.22-.01-.02a5.1 5.1 0 00-.15-.28 16 16 0 00-2.53-3.41zM6.24 13.93l.7-.7-.27-.29a15 15 0 01-2.08-2.9L4.56 10l.03-.04a15 15 0 012.09-2.9c1.47-1.6 3.6-3.12 6.32-3.12.98 0 1.88.2 2.7.52l.77-.76A8.32 8.32 0 0013 2.94c-3.12 0-5.5 1.75-7.06 3.44a16 16 0 00-2.38 3.38v.02h-.01L4 10l-.45-.22-.1.22.1.22L4 10l-.45.22.01.02a5.5 5.5 0 00.15.28 16 16 0 002.53 3.41zm6.09-.43a3.6 3.6 0 004.24-4.24l-.93.93a2.6 2.6 0 01-2.36 2.36l-.95.95zm-1.97-3.69l-.93.93a3.6 3.6 0 014.24-4.24l-.95.95a2.6 2.6 0 00-2.36 2.36zm11.29 7.84l-.8.79a1.5 1.5 0 000 2.12l.59.59a1.5 1.5 0 002.12 0l1.8-1.8-.71-.7-1.8 1.79a.5.5 0 01-.7 0l-.59-.59a1.5 1.5 0 010-.7l.8-.8-.71-.7zm-5.5 3.5l.35.35-.35-.35.01-.02.02-.02.02-.02a4.68 4.68 0 01.65-.5c.4-.27 1-.59 1.65-.59.66 0 1.28.33 1.73.77.44.45.77 1.07.77 1.73a2.5 2.5 0 01-.77 1.73 2.5 2.5 0 01-1.73.77h-4a.5.5 0 01-.42-.78l1-1.5 1-1.5a.5.5 0 01.07-.07zm.74.67a3.46 3.46 0 01.51-.4c.35-.24.75-.42 1.1-.42.34 0 .72.17 1.02.48.3.3.48.68.48 1.02 0 .34-.17.72-.48 1.02-.3.3-.68.48-1.02.48h-3.07l.49-.72.97-1.46zM21.2 2.5L5.5 18.2l-.7-.7L20.5 1.8l.7.7z"></path></svg>`,
    trash: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M18 7h5v1h-2.01l-1.33 14.64a1.5 1.5 0 0 1-1.5 1.36H9.84a1.5 1.5 0 0 1-1.49-1.36L7.01 8H5V7h5V6c0-1.1.9-2 2-2h4a2 2 0 0 1 2 2v1Zm-6-2a1 1 0 0 0-1 1v1h6V6a1 1 0 0 0-1-1h-4ZM8.02 8l1.32 14.54a.5.5 0 0 0 .5.46h8.33a.5.5 0 0 0 .5-.46L19.99 8H8.02Z"></path></svg>`,
    favorite: `<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12,2 15,9 22,9 17,14 19,21 12,17 5,21 7,14 2,9 9,9"/></svg>`,
};


export type DrawingTool = string;

interface ToolItem {
    id: string;
    name: string;
    icon: string;
    shortcut?: string;
    favorite?: boolean;
}

interface ToolGroup {
    id: string;
    name: string;
    defaultIcon: string;
    display?: 'list' | 'grid';
    columns?: number;
    tools: ToolItem[];
}

const TOOL_GROUPS: ToolGroup[] = [
    {
        id: 'cursor',
        name: 'Cursor',
        defaultIcon: DRAWING_ICONS.crosshair,
        tools: [
            { id: 'crosshair', name: 'Crosshair', icon: DRAWING_ICONS.crosshair },
            { id: 'arrowCursor', name: 'Cursor', icon: DRAWING_ICONS.arrowCursor },
        ]
    },
    {
        id: 'lines',
        name: 'Lines',
        defaultIcon: DRAWING_ICONS.trendLine,
        tools: [
            { id: 'trendLine', name: 'Trend Line', icon: DRAWING_ICONS.trendLine, shortcut: '⌥T', favorite: true },
            { id: 'ray', name: 'Ray', icon: DRAWING_ICONS.ray, favorite: true },
            { id: 'infoLine', name: 'Info Line', icon: DRAWING_ICONS.infoLine },
            { id: 'extendedLine', name: 'Extended Line', icon: DRAWING_ICONS.extendedLine },
            { id: 'trendAngle', name: 'Trend Angle', icon: DRAWING_ICONS.trendAngle },
            { id: 'horizontalLine', name: 'Horizontal Line', icon: DRAWING_ICONS.horizontalLine, shortcut: '⌥H', favorite: true },
            { id: 'horizontalRay', name: 'Horizontal Ray', icon: DRAWING_ICONS.horizontalRay, shortcut: '⌥J', favorite: true },
            { id: 'verticalLine', name: 'Vertical Line', icon: DRAWING_ICONS.verticalLine, shortcut: '⌥V' },
            { id: 'crossLine', name: 'Cross Line', icon: DRAWING_ICONS.crossLine, shortcut: '⌥C' },
        ]
    },
    {
        id: 'channels',
        name: 'Channels',
        defaultIcon: DRAWING_ICONS.parallelChannel,
        tools: [
            { id: 'parallelChannel', name: 'Parallel Channel', icon: DRAWING_ICONS.parallelChannel, favorite: true },
            { id: 'regressionTrend', name: 'Regression Trend', icon: DRAWING_ICONS.regressionTrend },
        ]
    },
    {
        id: 'fibonacci',
        name: 'Fibonacci',
        defaultIcon: DRAWING_ICONS.fibRetracement,
        tools: [
            { id: 'fibRetracement', name: 'Fib Retracement', icon: DRAWING_ICONS.fibRetracement, favorite: true },
            { id: 'fibExtension', name: 'Fib Extension', icon: DRAWING_ICONS.fibExtension },
            { id: 'fibChannel', name: 'Fib Channel', icon: DRAWING_ICONS.fibChannel },
        ]
    },
    {
        id: 'shapes',
        name: 'Shapes',
        defaultIcon: DRAWING_ICONS.brush,
        tools: [
            { id: 'brush', name: 'Brush', icon: DRAWING_ICONS.brush, favorite: true },
            { id: 'highlighter', name: 'Highlighter', icon: DRAWING_ICONS.highlighter },
            { id: 'arrow', name: 'Arrow', icon: DRAWING_ICONS.arrow },
            { id: 'arrowMarker', name: 'Arrow Marker', icon: DRAWING_ICONS.arrowMarker },
            { id: 'arrowMarkedUp', name: 'Arrow Marked Up', icon: DRAWING_ICONS.arrowMarkedUp },
            { id: 'arrowMarkedDown', name: 'Arrow Marked Down', icon: DRAWING_ICONS.arrowMarkedDown },
            { id: 'rectangle', name: 'Rectangle', icon: DRAWING_ICONS.rectangle },
            { id: 'rotatedRectangle', name: 'Rotated Rectangle', icon: DRAWING_ICONS.rotatedRectangle },
            { id: 'ellipse', name: 'Ellipse', icon: DRAWING_ICONS.ellipse },
            { id: 'triangle', name: 'Triangle', icon: DRAWING_ICONS.triangle },
            { id: 'arc', name: 'Arc', icon: DRAWING_ICONS.arc },
            { id: 'path', name: 'Path', icon: DRAWING_ICONS.path },
            { id: 'circle', name: 'Circle', icon: DRAWING_ICONS.circle },
            { id: 'polyline', name: 'Polyline', icon: DRAWING_ICONS.polyline },
            { id: 'curve', name: 'Curve', icon: DRAWING_ICONS.curve },
        ]
    },
    {
        id: 'patterns',
        name: 'Patterns',
        defaultIcon: DRAWING_ICONS.xabcd,
        tools: [
            { id: 'xabcd', name: 'XABCD Pattern', icon: DRAWING_ICONS.xabcd },
            { id: 'elliotImpulse', name: 'Elliott Impulse Wave (12345)', icon: DRAWING_ICONS.elliotImpulse },
            { id: 'elliotCorrection', name: 'Elliot Correction Wave (ABC)', icon: DRAWING_ICONS.elliotCorrection },
            { id: 'threeDrives', name: 'Three Drives Pattern', icon: DRAWING_ICONS.threeDrives },
            { id: 'headShoulders', name: 'Head & Shoulders', icon: DRAWING_ICONS.headShoulders },
            { id: 'abcd', name: 'ABCD Pattern', icon: DRAWING_ICONS.abcd },
            { id: 'trianglePattern', name: 'Triangle Pattern', icon: DRAWING_ICONS.trianglePattern },
        ]
    },
    {
        id: 'projection',
        name: 'Projection',
        defaultIcon: DRAWING_ICONS.longPosition,
        tools: [
            { id: 'longPosition', name: 'Long Position', icon: DRAWING_ICONS.longPosition },
            { id: 'shortPosition', name: 'Short Position', icon: DRAWING_ICONS.shortPosition },
            { id: 'priceRange', name: 'Price Range', icon: DRAWING_ICONS.priceRange },
            { id: 'dateRange', name: 'Date Range', icon: DRAWING_ICONS.dateRange },
            { id: 'datePriceRange', name: 'Date and Price Range', icon: DRAWING_ICONS.datePriceRange },
        ]
    },
    {
        id: 'annotation',
        name: 'Text',
        defaultIcon: DRAWING_ICONS.text,
        tools: [
            { id: 'text', name: 'Text', icon: DRAWING_ICONS.text, favorite: true },
            { id: 'callout', name: 'Callout', icon: DRAWING_ICONS.callout },
            { id: 'priceLabel', name: 'Price Label', icon: DRAWING_ICONS.priceLabel },
            { id: 'flagMarked', name: 'Flag Marked', icon: DRAWING_ICONS.flagMarked },
        ]
    },
    {
        id: 'emotion',
        name: 'Emotion',
        defaultIcon: DRAWING_ICONS.sticker,
        tools: [
            // Faces - Happy
            { id: 'sticker-smile', name: 'Smile', icon: '😀' },
            { id: 'sticker-grin', name: 'Grin', icon: '😁' },
            { id: 'sticker-laugh', name: 'Laugh', icon: '😂' },
            { id: 'sticker-rofl', name: 'ROFL', icon: '🤣' },
            { id: 'sticker-joy', name: 'Joy', icon: '😊' },
            { id: 'sticker-wink', name: 'Wink', icon: '😉' },
            { id: 'sticker-heart-eyes', name: 'Heart Eyes', icon: '😍' },
            { id: 'sticker-star-eyes', name: 'Star Eyes', icon: '🤩' },
            { id: 'sticker-kiss', name: 'Kiss', icon: '😘' },
            { id: 'sticker-cool', name: 'Cool', icon: '😎' },
            { id: 'sticker-smirk', name: 'Smirk', icon: '😏' },
            { id: 'sticker-halo', name: 'Halo', icon: '😇' },
            // Faces - Thinking/Neutral
            { id: 'sticker-think', name: 'Think', icon: '🤔' },
            { id: 'sticker-raised-eyebrow', name: 'Raised Eyebrow', icon: '🤨' },
            { id: 'sticker-neutral', name: 'Neutral', icon: '😐' },
            { id: 'sticker-expressionless', name: 'Expressionless', icon: '😑' },
            { id: 'sticker-unamused', name: 'Unamused', icon: '😒' },
            { id: 'sticker-rolling-eyes', name: 'Rolling Eyes', icon: '🙄' },
            // Faces - Sad/Negative
            { id: 'sticker-cry', name: 'Cry', icon: '😭' },
            { id: 'sticker-sad', name: 'Sad', icon: '😢' },
            { id: 'sticker-worried', name: 'Worried', icon: '😟' },
            { id: 'sticker-shock', name: 'Shock', icon: '😱' },
            { id: 'sticker-angry', name: 'Angry', icon: '😠' },
            { id: 'sticker-rage', name: 'Rage', icon: '🤬' },
            { id: 'sticker-scared', name: 'Scared', icon: '😨' },
            { id: 'sticker-sweat', name: 'Sweat', icon: '😰' },
            { id: 'sticker-sick', name: 'Sick', icon: '🤢' },
            { id: 'sticker-dead', name: 'Dead', icon: '💀' },
            { id: 'sticker-clown', name: 'Clown', icon: '🤡' },
            { id: 'sticker-mind-blown', name: 'Mind Blown', icon: '🤯' },
            // Gestures
            { id: 'sticker-thumbs-up', name: 'Thumbs Up', icon: '👍' },
            { id: 'sticker-thumbs-down', name: 'Thumbs Down', icon: '👎' },
            { id: 'sticker-clap', name: 'Clap', icon: '👏' },
            { id: 'sticker-raised-hands', name: 'Raised Hands', icon: '🙌' },
            { id: 'sticker-pray', name: 'Pray', icon: '🙏' },
            { id: 'sticker-muscle', name: 'Muscle', icon: '💪' },
            { id: 'sticker-punch', name: 'Punch', icon: '👊' },
            { id: 'sticker-victory', name: 'Victory', icon: '✌️' },
            { id: 'sticker-ok', name: 'OK', icon: '👌' },
            { id: 'sticker-point-up', name: 'Point Up', icon: '☝️' },
            { id: 'sticker-point-right', name: 'Point Right', icon: '👉' },
            { id: 'sticker-point-down', name: 'Point Down', icon: '👇' },
            // Trading & Finance
            { id: 'sticker-rocket', name: 'Rocket', icon: '🚀' },
            { id: 'sticker-fire', name: 'Fire', icon: '🔥' },
            { id: 'sticker-diamond', name: 'Diamond', icon: '💎' },
            { id: 'sticker-money-bag', name: 'Money Bag', icon: '💰' },
            { id: 'sticker-dollar', name: 'Dollar', icon: '💵' },
            { id: 'sticker-chart-up', name: 'Chart Up', icon: '📈' },
            { id: 'sticker-chart-down', name: 'Chart Down', icon: '📉' },
            { id: 'sticker-target', name: 'Target', icon: '🎯' },
            { id: 'sticker-trophy', name: 'Trophy', icon: '🏆' },
            { id: 'sticker-medal', name: 'Medal', icon: '🥇' },
            { id: 'sticker-crown', name: 'Crown', icon: '👑' },
            { id: 'sticker-gem', name: 'Gem', icon: '💠' },
            // Animals & Nature
            { id: 'sticker-bull', name: 'Bull', icon: '🐂' },
            { id: 'sticker-bear', name: 'Bear', icon: '🐻' },
            { id: 'sticker-whale', name: 'Whale', icon: '🐋' },
            { id: 'sticker-shark', name: 'Shark', icon: '🦈' },
            { id: 'sticker-eagle', name: 'Eagle', icon: '🦅' },
            { id: 'sticker-lion', name: 'Lion', icon: '🦁' },
            { id: 'sticker-moon', name: 'Moon', icon: '🌕' },
            { id: 'sticker-sun', name: 'Sun', icon: '☀️' },
            { id: 'sticker-rainbow', name: 'Rainbow', icon: '🌈' },
            { id: 'sticker-lightning', name: 'Lightning', icon: '⚡' },
            // Symbols
            { id: 'sticker-star', name: 'Star', icon: '⭐' },
            { id: 'sticker-sparkles', name: 'Sparkles', icon: '✨' },
            { id: 'sticker-heart', name: 'Heart', icon: '❤️' },
            { id: 'sticker-broken-heart', name: 'Broken Heart', icon: '💔' },
            { id: 'sticker-100', name: '100', icon: '💯' },
            { id: 'sticker-check', name: 'Check', icon: '✅' },
            { id: 'sticker-cross', name: 'Cross', icon: '❌' },
            { id: 'sticker-warning', name: 'Warning', icon: '⚠️' },
            { id: 'sticker-stop', name: 'Stop', icon: '🛑' },
            { id: 'sticker-bell', name: 'Bell', icon: '🔔' },
            { id: 'sticker-eyes', name: 'Eyes', icon: '👀' },
            { id: 'sticker-brain', name: 'Brain', icon: '🧠' },
            // Celebration
            { id: 'sticker-celebrate', name: 'Celebrate', icon: '🥳' },
            { id: 'sticker-party', name: 'Party', icon: '🎉' },
            { id: 'sticker-confetti', name: 'Confetti', icon: '🎊' },
            { id: 'sticker-balloon', name: 'Balloon', icon: '🎈' },
            { id: 'sticker-champagne', name: 'Champagne', icon: '🍾' },
            { id: 'sticker-beer', name: 'Beer', icon: '🍺' },
        ],
        display: 'grid',
        columns: 8,
    },
    {
        id: 'magnet',
        name: 'Magnet',
        defaultIcon: DRAWING_ICONS.weakMagnet,
        tools: [
            { id: 'weakMagnet', name: 'Weak Magnet', icon: DRAWING_ICONS.weakMagnet },
            { id: 'strongMagnet', name: 'Strong Magnet', icon: DRAWING_ICONS.strongMagnet },
        ]
    },
];

/**
 * TradingView-style left drawing toolbar with flyout menus
 */
export class DrawingToolbarWidget {
    private _element: HTMLElement | null = null;
    private _activeTool: DrawingTool = 'crosshair';
    private _activeGroupTools: Map<string, string> = new Map();
    private _flyoutContainer: HTMLElement | null = null;
    private _activeFlyout: string | null = null;
    private _magnetMode: 'none' | 'weak' | 'strong' = 'none';
    private _isLocked: boolean = false;
    private _isVisibilityHidden: boolean = false;

    // Events
    private readonly _toolChanged = new Delegate<DrawingTool>();
    private readonly _magnetToggled = new Delegate<boolean>();
    private readonly _lockToggled = new Delegate<boolean>();
    private readonly _visibilityToggled = new Delegate<boolean>();
    private readonly _deleteAllClicked = new Delegate<void>();

    constructor(container: HTMLElement) {
        // Initialize default tools for each group
        TOOL_GROUPS.forEach(group => {
            this._activeGroupTools.set(group.id, group.tools[0].id);
        });
        this._createElement(container);
    }

    // --- Public getters ---

    get element(): HTMLElement | null {
        return this._element;
    }

    get width(): number {
        return 48;
    }

    get activeTool(): DrawingTool {
        return this._activeTool;
    }

    get toolChanged(): Delegate<DrawingTool> {
        return this._toolChanged;
    }

    get magnetToggled(): Delegate<boolean> {
        return this._magnetToggled;
    }

    get lockToggled(): Delegate<boolean> {
        return this._lockToggled;
    }

    get visibilityToggled(): Delegate<boolean> {
        return this._visibilityToggled;
    }

    get deleteAllClicked(): Delegate<void> {
        return this._deleteAllClicked;
    }

    // --- Public methods ---

    setActiveTool(tool: DrawingTool): void {
        if (this._activeTool === tool) return;
        this._activeTool = tool;

        // If a drawing tool is selected (not cursor tools), auto-unlock
        const cursorTools = ['crosshair', 'arrowCursor', 'cursor'];
        const isDrawingTool = !cursorTools.includes(tool);

        if (isDrawingTool) {
            let changed = false;
            if (this._isLocked) {
                this._isLocked = false;
                this._lockToggled.fire(false);
                changed = true;
            }
            if (this._isVisibilityHidden) {
                this._isVisibilityHidden = false;
                this._visibilityToggled.fire(false);
                changed = true;
            }
            if (changed) {
                this._updateUtilityButtons();
            }
        }

        this._updateToolButtons();
        this._toolChanged.fire(tool);
    }

    getToolIcon(toolId: string): string | null {
        for (const group of TOOL_GROUPS) {
            const tool = group.tools.find(t => t.id === toolId);
            if (tool) return tool.icon;
        }
        return null;
    }

    get magnetMode(): 'none' | 'weak' | 'strong' {
        return this._magnetMode;
    }

    set magnetMode(mode: 'none' | 'weak' | 'strong') {
        this._magnetMode = mode;
        this._updateMagnetButtons();
    }

    private _updateMagnetButtons(): void {
        // Update magnet group button appearance
        const magnetBtn = this._element?.querySelector('button[data-group-id="magnet"]') as HTMLButtonElement;
        if (magnetBtn) {
            const isActive = this._magnetMode !== 'none';
            magnetBtn.style.background = isActive ? '#2962ff' : 'transparent';
            magnetBtn.style.color = isActive ? '#fff' : '#787b86';
            magnetBtn.dataset.active = isActive.toString();
        }
    }

    get isLocked(): boolean {
        return this._isLocked;
    }

    set isLocked(value: boolean) {
        this._isLocked = value;
        this._updateUtilityButtons();
    }

    get isVisibilityHidden(): boolean {
        return this._isVisibilityHidden;
    }

    set isVisibilityHidden(value: boolean) {
        this._isVisibilityHidden = value;
        this._updateUtilityButtons();
    }

    private _updateUtilityButtons(): void {
        const lockBtn = this._element?.querySelector('button[data-id="lock"]') as HTMLButtonElement;
        if (lockBtn) {
            lockBtn.style.background = this._isLocked ? '#ef5350' : 'transparent';
            lockBtn.style.color = this._isLocked ? '#fff' : '#787b86';
            lockBtn.innerHTML = this._isLocked ? DRAWING_ICONS.lockClosed : DRAWING_ICONS.lock;
        }

        const visibilityBtn = this._element?.querySelector('button[data-id="visibility"]') as HTMLButtonElement;
        if (visibilityBtn) {
            visibilityBtn.style.background = this._isVisibilityHidden ? '#ef5350' : 'transparent';
            visibilityBtn.style.color = this._isVisibilityHidden ? '#fff' : '#787b86';
            visibilityBtn.innerHTML = this._isVisibilityHidden ? DRAWING_ICONS.hidden : DRAWING_ICONS.visible;
        }
    }

    // --- Private methods ---

    private _createElement(container: HTMLElement): void {
        this._element = document.createElement('div');
        this._element.className = 'drawing-toolbar';
        this._element.style.cssText = `
            position: absolute;
            left: 0;
            top: 38px;
            bottom: 30px;
            width: 48px;
            background: #131722;
            border-right: 1px solid #2B2B43;
            display: flex;
            flex-direction: column;
            padding: 4px;
            font-family: -apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif;
            user-select: none;
            z-index: 100;
            overflow-y: auto;
            overflow-x: hidden;
            scrollbar-width: thin;
        `;

        // Add styles
        const style = document.createElement('style');
        style.textContent = `
            .drawing-toolbar::-webkit-scrollbar { width: 4px; }
            .drawing-toolbar::-webkit-scrollbar-track { background: transparent; }
            .drawing-toolbar::-webkit-scrollbar-thumb { background: #2a2e39; border-radius: 2px; }
            .drawing-flyout {
                position: absolute;
                left: 48px;
                background: #1e222d;
                border: 1px solid #2B2B43;
                border-radius: 4px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                min-width: 200px;
                max-height: calc(100vh - 100px);
                overflow-y: auto;
                padding: 4px 0;
                z-index: 1000;
            }
            .drawing-flyout::-webkit-scrollbar { width: 6px; }
            .drawing-flyout::-webkit-scrollbar-track { background: transparent; }
            .drawing-flyout::-webkit-scrollbar-thumb { background: #2a2e39; border-radius: 3px; }
            .drawing-flyout-header {
                padding: 8px 12px;
                color: #787b86;
                font-size: 11px;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            .drawing-flyout-item {
                display: flex;
                align-items: center;
                padding: 8px 12px;
                color: #d1d4dc;
                font-size: 13px;
                cursor: pointer;
                transition: background 0.1s;
            }
            .drawing-flyout-item:hover {
                background: #2a2e39;
            }
            .drawing-flyout-item.active {
                background: #2962ff;
                color: #fff;
            }
            .drawing-flyout-item-icon {
                width: 24px;
                height: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 10px;
            }
            .drawing-flyout-item-name {
                flex: 1;
            }
            .drawing-flyout-item-shortcut {
                color: #787b86;
                font-size: 11px;
                margin-left: 12px;
            }
            .drawing-flyout-item-favorite {
                color: #f0b90b;
                margin-left: 8px;
            }
            .drawing-flyout-grid {
                display: grid;
                gap: 2px;
                padding: 4px;
            }
            .drawing-flyout-grid-item {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 32px;
                height: 32px;
                color: #d1d4dc;
                font-size: 20px;
                cursor: pointer;
                transition: background 0.1s;
                border-radius: 4px;
            }
            .drawing-flyout-grid-item:hover {
                background: #2a2e39;
            }
            .drawing-flyout-grid-item.active {
                background: #2962ff;
                color: #fff;
            }
        `;
        document.head.appendChild(style);

        // Create flyout container (outside toolbar for proper positioning)
        this._flyoutContainer = document.createElement('div');
        this._flyoutContainer.style.cssText = `
            position: absolute;
            left: 0;
            top: 0;
            z-index: 1000;
            pointer-events: none;
        `;
        container.appendChild(this._flyoutContainer);

        // Create group buttons
        TOOL_GROUPS.forEach(group => {
            this._createGroupButton(group);
        });

        // Utility buttons at the end of the list
        this._createUtilityButton(DRAWING_ICONS.lock, 'Lock Drawings', () => {
            this._isLocked = !this._isLocked;
            this._updateUtilityButtons();
            this._lockToggled.fire(this._isLocked);
        }, false, 'lock');

        this._createUtilityButton(DRAWING_ICONS.visible, 'Hide Drawings', () => {
            this._isVisibilityHidden = !this._isVisibilityHidden;
            this._updateUtilityButtons();
            this._visibilityToggled.fire(this._isVisibilityHidden);
        }, false, 'visibility');

        this._createUtilityButton(DRAWING_ICONS.trash, 'Delete All', () => this._deleteAllClicked.fire(), true, 'trash');

        container.appendChild(this._element);

        // Close flyout on click outside
        document.addEventListener('click', (e) => {
            if (this._activeFlyout && !this._element?.contains(e.target as Node) &&
                !this._flyoutContainer?.contains(e.target as Node)) {
                this._closeFlyout();
            }
        });
    }

    private _createGroupButton(group: ToolGroup): void {
        const btn = document.createElement('button');
        const activeTool = this._activeGroupTools.get(group.id) || group.tools[0].id;
        const activeToolConfig = group.tools.find(t => t.id === activeTool);
        const isActive = this._activeTool === activeTool;
        const isGridGroup = group.display === 'grid';

        btn.innerHTML = (isGridGroup) ? group.defaultIcon : (activeToolConfig?.icon || group.defaultIcon);
        btn.title = group.name;
        btn.dataset.groupId = group.id;
        btn.dataset.active = isActive.toString();

        btn.style.cssText = `
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 36px;
            background: ${isActive ? '#2962ff' : 'transparent'};
            border: none;
            border-radius: 4px;
            color: ${isActive ? '#fff' : '#787b86'};
            cursor: pointer;
            transition: all 0.15s ease;
            margin-bottom: 8px;
        `;

        // Right-pointing chevron indicator for dropdown (only visible on hover)
        if (group.tools.length > 1) {
            const indicator = document.createElement('div');
            indicator.className = 'dropdown-indicator';
            indicator.innerHTML = `<svg width="8" height="8" viewBox="0 0 8 8" fill="none">
                <path d="M3 2L5 4L3 6" stroke="${isActive ? '#fff' : '#787b86'}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`;
            indicator.style.cssText = `
                position: absolute;
                right: 2px;
                top: 50%;
                transform: translateY(-50%);
                width: 8px;
                height: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                transition: opacity 0.15s ease;
            `;
            btn.appendChild(indicator);
        }

        btn.addEventListener('mouseenter', () => {
            if (btn.dataset.active !== 'true') {
                btn.style.background = '#2a2e39';
                btn.style.color = '#d1d4dc';
            }
            // Show chevron indicator on hover
            const indicator = btn.querySelector('.dropdown-indicator') as HTMLElement;
            if (indicator) {
                indicator.style.opacity = '1';
            }
            // Show flyout
            if (group.tools.length > 1) {
                this._showFlyout(group, btn);
            }
        });

        btn.addEventListener('mouseleave', () => {
            if (btn.dataset.active !== 'true') {
                btn.style.background = 'transparent';
                btn.style.color = '#787b86';
            }
            // Hide chevron indicator when not hovering
            const indicator = btn.querySelector('.dropdown-indicator') as HTMLElement;
            if (indicator) {
                indicator.style.opacity = '0';
            }
        });

        btn.addEventListener('click', () => {
            const tool = this._activeGroupTools.get(group.id) || group.tools[0].id;
            this.setActiveTool(tool);
            this._closeFlyout();
        });

        this._element!.appendChild(btn);
    }

    private _showFlyout(group: ToolGroup, anchorBtn: HTMLElement): void {
        if (this._activeFlyout === group.id) return;
        this._closeFlyout();

        this._activeFlyout = group.id;

        const flyout = document.createElement('div');
        flyout.className = 'drawing-flyout';
        flyout.style.pointerEvents = 'auto';

        // Position flyout
        flyout.style.left = '48px';

        // Groups with many items (shapes, emotion) start from first button position for full visibility
        if (group.id === 'shapes' || group.id === 'emotion') {
            flyout.style.top = '38px';  // Aligned with first toolbar button
            flyout.style.maxHeight = 'calc(100vh - 100px)';
            flyout.style.overflowY = 'auto';
        } else {
            // Other groups align with their button
            const rect = anchorBtn.getBoundingClientRect();
            const containerRect = this._element!.parentElement!.getBoundingClientRect();
            flyout.style.top = `${rect.top - containerRect.top}px`;
        }

        this._flyoutContainer!.appendChild(flyout);

        // Header
        const header = document.createElement('div');
        header.className = 'drawing-flyout-header';
        header.textContent = group.name.toUpperCase();
        flyout.appendChild(header);

        // Tool items
        if (group.display === 'grid') {
            const grid = document.createElement('div');
            grid.className = 'drawing-flyout-grid';
            grid.style.gridTemplateColumns = `repeat(${group.columns || 6}, 1fr)`;

            group.tools.forEach(tool => {
                const item = document.createElement('div');
                item.className = 'drawing-flyout-grid-item';
                if (tool.id === this._activeTool) {
                    item.classList.add('active');
                }
                item.innerHTML = tool.icon;
                item.title = tool.name;

                item.addEventListener('click', () => {
                    this._activeGroupTools.set(group.id, tool.id);
                    this.setActiveTool(tool.id);
                    // Do NOT update button icon for grid groups (e.g. Emotions)
                    if (group.display !== 'grid') {
                        this._updateGroupButtonIcon(group.id, tool.icon);
                    }
                    this._closeFlyout();
                });

                grid.appendChild(item);
            });
            flyout.appendChild(grid);
        } else {
            group.tools.forEach(tool => {
                const item = document.createElement('div');
                item.className = 'drawing-flyout-item';
                if (tool.id === this._activeTool) {
                    item.classList.add('active');
                }

                const icon = document.createElement('div');
                icon.className = 'drawing-flyout-item-icon';
                icon.innerHTML = tool.icon;
                item.appendChild(icon);

                const name = document.createElement('span');
                name.className = 'drawing-flyout-item-name';
                name.textContent = tool.name;
                item.appendChild(name);

                if (tool.shortcut) {
                    const shortcut = document.createElement('span');
                    shortcut.className = 'drawing-flyout-item-shortcut';
                    shortcut.textContent = tool.shortcut;
                    item.appendChild(shortcut);
                }

                if (tool.favorite) {
                    const fav = document.createElement('span');
                    fav.className = 'drawing-flyout-item-favorite';
                    fav.innerHTML = DRAWING_ICONS.favorite;
                    item.appendChild(fav);
                }

                item.addEventListener('click', () => {
                    this._activeGroupTools.set(group.id, tool.id);
                    this.setActiveTool(tool.id);
                    this._updateGroupButtonIcon(group.id, tool.icon);
                    this._closeFlyout();
                });

                flyout.appendChild(item);
            });
        }

        // Keep flyout open when hovering over it
        flyout.addEventListener('mouseenter', () => {
            // Flyout stays open
        });

        flyout.addEventListener('mouseleave', () => {
            this._closeFlyout();
        });

        // Flyout is already in DOM from measurement step above
    }

    private _closeFlyout(): void {
        if (this._flyoutContainer) {
            this._flyoutContainer.innerHTML = '';
        }
        this._activeFlyout = null;
    }

    private _updateGroupButtonIcon(groupId: string, icon: string): void {
        const btn = this._element?.querySelector(`button[data-group-id="${groupId}"]`) as HTMLButtonElement;
        if (btn) {
            // Preserve the triangle indicator
            const indicator = btn.querySelector('div');
            btn.innerHTML = icon;
            if (indicator) {
                btn.appendChild(indicator);
            }
        }
    }

    private _createUtilityButton(icon: string, title: string, onClick: () => void, isDanger: boolean = false, id?: string): void {
        const btn = document.createElement('button');
        if (id) btn.dataset.id = id;
        btn.innerHTML = icon;
        btn.title = title;

        btn.style.cssText = `
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 32px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: ${isDanger ? '#ef5350' : '#787b86'};
            cursor: pointer;
            transition: all 0.15s ease;
            margin-bottom: 8px;
        `;

        btn.addEventListener('mouseenter', () => {
            btn.style.background = isDanger ? 'rgba(239, 83, 80, 0.1)' : '#2a2e39';
            btn.style.color = isDanger ? '#ef5350' : '#d1d4dc';
        });

        btn.addEventListener('mouseleave', () => {
            btn.style.background = 'transparent';
            btn.style.color = isDanger ? '#ef5350' : '#787b86';
        });

        btn.addEventListener('click', onClick);
        this._element!.appendChild(btn);
    }

    private _updateToolButtons(): void {
        const buttons = this._element?.querySelectorAll('button[data-group-id]');
        buttons?.forEach(btn => {
            const htmlBtn = btn as HTMLButtonElement;
            const groupId = htmlBtn.dataset.groupId!;
            const group = TOOL_GROUPS.find(g => g.id === groupId);
            if (!group) return;

            // Skip magnet group - it has its own state management
            if (groupId === 'magnet') {
                // Keep magnet button state based on _magnetMode
                const isMagnetActive = this._magnetMode !== 'none';
                htmlBtn.dataset.active = isMagnetActive.toString();
                htmlBtn.style.background = isMagnetActive ? '#2962ff' : 'transparent';
                htmlBtn.style.color = isMagnetActive ? '#fff' : '#787b86';
                return;
            }

            const groupActiveTool = this._activeGroupTools.get(groupId);
            const isActive = group.tools.some(t => t.id === this._activeTool) && groupActiveTool === this._activeTool;

            htmlBtn.dataset.active = isActive.toString();
            htmlBtn.style.background = isActive ? '#2962ff' : 'transparent';
            htmlBtn.style.color = isActive ? '#fff' : '#787b86';

            // Update indicator SVG color
            const indicator = htmlBtn.querySelector('.dropdown-indicator svg path') as SVGPathElement;
            if (indicator) {
                indicator.setAttribute('stroke', isActive ? '#fff' : '#787b86');
            }
        });
    }

    // --- Cleanup ---

    dispose(): void {
        this._toolChanged.destroy();
        this._magnetToggled.destroy();
        this._lockToggled.destroy();
        this._visibilityToggled.destroy();
        this._deleteAllClicked.destroy();

        if (this._flyoutContainer && this._flyoutContainer.parentNode) {
            this._flyoutContainer.parentNode.removeChild(this._flyoutContainer);
        }

        if (this._element && this._element.parentNode) {
            this._element.parentNode.removeChild(this._element);
        }
        this._element = null;
        this._flyoutContainer = null;
    }
}
